~<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë§¤ì¶œì§€í‚´ì´ â€” ê³ ê¸°ì™•ê¹€ì¹˜ì°œ ì •ë¦‰ì  2026ë…„ 1ì›”</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#F4F5F9;--card:#fff;--border:#E4E7EE;
  --accent:#FF6B35;--accent-soft:rgba(255,107,53,0.08);
  --green:#10B981;--green-soft:rgba(16,185,129,0.08);
  --red:#EF4444;--red-soft:rgba(239,68,68,0.08);
  --yellow:#F59E0B;--yellow-soft:rgba(245,158,11,0.08);
  --blue:#3B82F6;--blue-soft:rgba(59,130,246,0.08);
  --purple:#8B5CF6;--pink:#EC4899;
  --text:#1A1D26;--text-sec:#3D4355;--text-dim:#8490A7;--text-muted:#B0BAC9;
}
body{background:var(--bg);font-family:'Pretendard','Noto Sans KR',-apple-system,sans-serif;color:var(--text);line-height:1.5}
.wrap{max-width:1200px;margin:0 auto;padding:24px 20px}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;animation:fadeUp .5s ease both}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,#FF6B35,#FF8F65);display:flex;align-items:center;justify-content:center;font-size:17px;box-shadow:0 2px 8px rgba(255,107,53,.3)}
.logo h1{font-size:21px;font-weight:800}
.logo p{font-size:12.5px;color:var(--text-dim)}
.badge{display:flex;align-items:center;gap:7px;background:var(--card);border:1px solid var(--border);border-radius:9px;padding:6px 12px;font-size:11px;color:var(--text-dim)}
.badge .dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green)}

/* Tabs */
.tabs{display:flex;gap:5px;margin-bottom:22px;overflow-x:auto;animation:fadeUp .5s ease .05s both}
.tab{padding:8px 16px;border-radius:9px;border:1px solid var(--border);background:var(--card);color:var(--text-dim);font-size:12.5px;font-weight:600;cursor:pointer;white-space:nowrap;transition:all .15s}
.tab.active{background:var(--accent);color:#fff;border:none;box-shadow:0 2px 8px rgba(255,107,53,.25)}
.tab:hover:not(.active){background:#F8F9FC}

/* Cards */
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px 24px;box-shadow:0 1px 4px rgba(0,0,0,.03)}
.card-title{display:flex;align-items:center;gap:8px;margin-bottom:3px}
.card-title .icon{font-size:17px}
.card-title .txt{font-size:15px;font-weight:700}
.card-sub{font-size:11.5px;color:var(--text-dim);margin-bottom:14px}

/* KPI Grid */
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:18px}
.kpi{position:relative;overflow:hidden}
.kpi .bar{position:absolute;top:0;left:0;right:0;height:3px;border-radius:14px 14px 0 0}
.kpi .label{font-size:11px;color:var(--text-dim);margin-bottom:5px;display:flex;align-items:center;gap:5px}
.kpi .value{font-size:19px;font-weight:800;font-variant-numeric:tabular-nums}

/* Tab panels */
.panel{display:none;animation:fadeUp .4s ease both}
.panel.active{display:block}

/* Calendar */
.cal-header{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:5px}
.cal-header div{text-align:center;font-size:10.5px;font-weight:600;padding:5px 0;color:var(--text-dim)}
.cal-header .sat{color:var(--blue)}
.cal-header .sun{color:var(--red)}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px}
.cal-cell{min-height:105px;border-radius:10px;padding:7px 7px 5px;cursor:pointer;transition:all .15s;position:relative;border:1.5px solid transparent}
.cal-cell:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.06)}
.cal-cell.selected{border:2px solid var(--accent) !important;background:rgba(255,107,53,.04) !important;box-shadow:0 2px 12px rgba(255,107,53,.15)}
.cal-cell .day-num{font-size:12px;font-weight:700}
.cal-cell .total{font-size:13px;font-weight:800;font-variant-numeric:tabular-nums;margin-bottom:3px}
.cal-cell .hbar{height:3px;background:rgba(0,0,0,.06);border-radius:2px;margin-bottom:4px;overflow:hidden}
.cal-cell .hbar-fill{height:100%;border-radius:2px;opacity:.6}
.cal-cell .item-tag{font-size:8px;color:var(--text-dim);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cal-cell .change-badge{font-size:8px;font-weight:700;padding:1px 3px;border-radius:3px}
.cal-cell .alert-dot{position:absolute;top:5px;right:5px;width:5px;height:5px;border-radius:50%;background:var(--red);box-shadow:0 0 4px var(--red)}
.cal-empty{min-height:105px;border-radius:10px;border:1px solid #F0F2F5;padding:8px 6px;background:#FAFBFC}
.cal-empty .day-num{font-size:11px;font-weight:600;color:var(--text-muted)}
.cal-legend{display:flex;gap:12px;justify-content:center;margin-top:10px;align-items:center;flex-wrap:wrap}
.cal-legend .swatch{width:12px;height:12px;border-radius:3px}

/* Day Detail Panel */
.day-detail{padding:14px 16px;background:#FAFBFE;border-radius:12px;border:1px solid var(--border)}
.day-detail .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.day-detail .amount{font-size:18px;font-weight:800;color:var(--accent);font-variant-numeric:tabular-nums}
.ratio-bar{height:8px;background:#F0F2F5;border-radius:4px;overflow:hidden;display:flex}
.pill-tags{display:flex;flex-wrap:wrap;gap:4px}
.pill{font-size:10px;padding:3px 6px;border-radius:5px;font-weight:600}

/* Item Price Tab */
.item-tabs{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:16px}
.item-tab{padding:6px 12px;border-radius:20px;border:1px solid var(--border);background:var(--card);color:var(--text-dim);font-size:11.5px;font-weight:600;cursor:pointer;white-space:nowrap;transition:all .15s}
.item-tab.active{color:#fff;border:none}
.kpi5{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:16px}
.kpi5 .box{padding:12px 10px;background:#FAFBFE;border-radius:10px;border:1px solid var(--border);text-align:center}
.kpi5 .box .lbl{font-size:10px;color:var(--text-dim);margin-bottom:4px}
.kpi5 .box .val{font-size:15px;font-weight:800;font-variant-numeric:tabular-nums}

/* Table */
.tbl{width:100%;border-collapse:collapse;font-size:11.5px}
.tbl th{text-align:right;padding:7px 10px;color:var(--text-dim);font-size:10px;font-weight:600;border-bottom:2px solid var(--border)}
.tbl th:first-child{text-align:left}
.tbl td{padding:8px 10px;border-bottom:1px solid #F0F2F5;font-variant-numeric:tabular-nums}
.tbl td:first-child{font-weight:600}
.tbl td:not(:first-child){text-align:right}

/* PnL */
.pnl-kpi{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:18px}
.pnl-row{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #F0F2F5}
.pnl-row.bold{border-bottom-color:var(--border);font-weight:700}
.pnl-row.highlight{background:rgba(16,185,129,.03)}
.pnl-input{border:1px solid var(--border);border-radius:6px;padding:6px 10px;font-size:13px;font-weight:600;font-family:inherit;text-align:right;width:155px;font-variant-numeric:tabular-nums;background:#FAFBFE;transition:all .15s;color:var(--text)}
.pnl-input:focus{outline:none;border-color:var(--accent);background:#fff;box-shadow:0 0 0 3px var(--accent-soft)}
.pnl-save-msg{font-size:11px;color:var(--green);font-weight:600;opacity:0;transition:opacity .3s}
.pnl-save-msg.show{opacity:1}

/* Two columns */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.grid-31{display:grid;grid-template-columns:3fr 1fr;gap:14px}

/* Bars */
.h-bar{display:flex;align-items:center;margin-bottom:10px}
.h-bar .name{font-size:12px;font-weight:600;width:105px;flex-shrink:0}
.h-bar .track{flex:1;height:7px;background:#F0F2F5;border-radius:4px;overflow:hidden;margin:0 10px}
.h-bar .fill{height:100%;border-radius:4px}
.h-bar .val{font-size:11px;font-weight:700;font-variant-numeric:tabular-nums;min-width:80px;text-align:right}

/* Supplier bars */
.sup-bar{margin-bottom:8px}
.sup-bar .top{display:flex;justify-content:space-between;margin-bottom:3px}
.sup-bar .top .nm{font-size:12px;font-weight:600}
.sup-bar .top .amt{font-size:11px;font-weight:700;font-variant-numeric:tabular-nums}
.sup-bar .track{height:6px;background:#F0F2F5;border-radius:3px;overflow:hidden}
.sup-bar .fill{height:100%;border-radius:3px}

/* Fee bar */
.fee-row{margin-bottom:10px}
.fee-row .top{display:flex;justify-content:space-between;margin-bottom:4px}
.fee-row .nm{font-size:12px;font-weight:600}
.fee-row .rate{font-weight:700;font-size:12px}
.fee-row .track{height:7px;background:#F0F2F5;border-radius:4px;overflow:hidden}
.fee-row .fill{height:100%;border-radius:4px;opacity:.7}

/* Expense cards */
.exp-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:14px}
.exp-card{text-align:center;padding:14px 10px;background:var(--card);border-radius:10px;border:1px solid var(--border)}
.exp-card .lbl{font-size:11px;color:var(--text-dim);margin-bottom:4px}
.exp-card .val{font-size:17px;font-weight:800;font-variant-numeric:tabular-nums}
.exp-card .sub{font-size:11px;font-weight:600;margin-top:2px}

/* OPEX list */
.opex-item{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;background:#FAFBFE;border-radius:7px;margin-bottom:6px}
.opex-item .left{display:flex;align-items:center;gap:6px}
.opex-item .icon{font-size:14px}
.opex-item .nm{font-size:12px;font-weight:600}
.opex-item .amt{font-size:12px;font-weight:700;font-variant-numeric:tabular-nums}

/* Insight */
.insight{padding:10px 14px;border-radius:8px;font-size:12px;line-height:1.7}

/* Animation */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
.anim{animation:fadeUp .5s ease both}

/* Responsive */
@media(max-width:768px){
  .kpi-grid,.pnl-kpi{grid-template-columns:repeat(2,1fr)}
  .kpi5{grid-template-columns:repeat(3,1fr)}
  .grid-2,.grid-31{grid-template-columns:1fr}
  .exp-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<div class="wrap">
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <div class="logo-icon">ğŸ›¡</div>
      <div><h1>ë§¤ì¶œì§€í‚´ì´</h1><p>ê³ ê¸°ì™•ê¹€ì¹˜ì°œ ì •ë¦‰ì  Â· 2026ë…„ 1ì›”</p></div>
    </div>
    <div class="badge">1/1 ~ 1/17 <div class="dot"></div></div>
  </div>

  <!-- Tabs -->
  <div class="tabs" id="tabs">
    <button class="tab active" data-tab="material">ğŸ”¥ ì¬ë£Œë¹„ ìº˜ë¦°ë”</button>
    <button class="tab" data-tab="itemPrice">ğŸ“‰ í’ˆëª©ë³„ ê°€ê²©ë³€ë™</button>
    <button class="tab" data-tab="supplier">ğŸ¢ ê±°ë˜ì²˜Â·í’ˆëª©</button>
    <button class="tab" data-tab="outflow">ğŸ’¸ ì§€ì¶œ ì „ì²´</button>
    <button class="tab" data-tab="channel">ğŸ“± ì±„ë„ ë¶„ì„</button>
    <button class="tab" data-tab="pnl">ğŸ“‹ ì†ìµê³„ì‚°ì„œ</button>
  </div>

  <!-- â•â•â•â• ğŸ”¥ ì¬ë£Œë¹„ ìº˜ë¦°ë” â•â•â•â• -->
  <div class="panel active" id="panel-material">
    <div class="kpi-grid anim" id="material-kpis"></div>
    <div class="grid-31 anim" style="animation-delay:.1s">
      <div class="card">
        <div class="card-title"><span class="icon">ğŸ“…</span><span class="txt">1ì›” ì‹ìì¬ ë°œì£¼ ìº˜ë¦°ë”</span></div>
        <div class="card-sub">ë‚ ì§œ í´ë¦­ â†’ ìƒì„¸ ë‚´ì—­ Â· ìƒ‰ìƒ = ì§€ì¶œ ê·œëª¨</div>
        <div class="cal-header">
          <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div class="sat">í† </div><div class="sun">ì¼</div>
        </div>
        <div class="cal-grid" id="calGrid"></div>
        <div class="cal-legend">
          <div style="display:flex;align-items:center;gap:3px"><div class="swatch" style="background:#E8F5E9;border:1px solid #A5D6A7"></div><span style="font-size:9.5px;color:var(--text-dim)">ì ìŒ</span></div>
          <div style="display:flex;align-items:center;gap:3px"><div class="swatch" style="background:#FFFDE7;border:1px solid #FFF176"></div><span style="font-size:9.5px;color:var(--text-dim)">ë³´í†µ</span></div>
          <div style="display:flex;align-items:center;gap:3px"><div class="swatch" style="background:#FFF3E0;border:1px solid #FFB74D"></div><span style="font-size:9.5px;color:var(--text-dim)">ë§ìŒ</span></div>
          <div style="display:flex;align-items:center;gap:3px"><div class="swatch" style="background:#FEE2E2;border:1px solid #FCA5A5"></div><span style="font-size:9.5px;color:var(--text-dim)">ê³¼ë‹¤</span></div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:14px">
        <div id="dayDetail"></div>
        <div class="card" style="background:linear-gradient(135deg,#FFF7ED,#fff);border:1px solid rgba(255,107,53,.15)">
          <div style="font-size:12px;font-weight:700;margin-bottom:8px">ğŸ’¡ íŒ¨í„´</div>
          <div style="font-size:11px;color:var(--text-sec);line-height:1.6">
            <p style="margin:0 0 4px">ì¼ìš”ì¼ ë°œì£¼ëŸ‰ ê¸‰ì¦</p>
            <p style="margin:0 0 4px">ìŒ€Â·ìŠ¤íŒ¸ ëŒ€ëŸ‰ë°œì£¼ = ë“±ë½ ì£¼ë²”</p>
            <p style="margin:0">ìµœì†Œâ†”ìµœëŒ€ <strong style="color:var(--red)">8.2ë°°</strong> ì°¨ì´</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â• ğŸ“‰ í’ˆëª©ë³„ ê°€ê²©ë³€ë™ â•â•â•â• -->
  <div class="panel" id="panel-itemPrice">
    <div class="card anim">
      <div class="card-title"><span class="icon">ğŸ“‰</span><span class="txt">í’ˆëª©ë³„ ê°€ê²© ë³€ë™ ì¶”ì </span></div>
      <div class="card-sub">í’ˆëª©ì„ ì„ íƒí•˜ë©´ ì¼ë³„ ë°œì£¼ê¸ˆì•¡ ë³€ë™, í‰ê·  ëŒ€ë¹„ ë“±ë½ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
      <div class="item-tabs" id="itemTabs"></div>
      <div class="kpi5" id="itemKpis"></div>
      <div style="height:240px;margin-bottom:16px"><canvas id="itemChart"></canvas></div>
      <div id="itemTable"></div>
    </div>
  </div>

  <!-- â•â•â•â• ğŸ¢ ê±°ë˜ì²˜Â·í’ˆëª© â•â•â•â• -->
  <div class="panel" id="panel-supplier">
    <div class="grid-2 anim">
      <div class="card">
        <div class="card-title"><span class="icon">ğŸ¢</span><span class="txt">ê±°ë˜ì²˜ë³„ ì‹ìì¬ ì§€ì¶œ</span></div>
        <div class="card-sub">ì´ 6,171,670ì›</div>
        <div style="height:300px"><canvas id="supplierChart"></canvas></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="icon">ğŸ¥©</span><span class="txt">í’ˆëª©ë³„ TOP ì§€ì¶œ</span></div>
        <div class="card-sub">ê¸ˆì•¡ ê¸°ì¤€ ìƒìœ„ í’ˆëª©</div>
        <div id="topItemBars"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â• ğŸ’¸ ì§€ì¶œ ì „ì²´ â•â•â•â• -->
  <div class="panel" id="panel-outflow">
    <div class="card anim" style="margin-bottom:18px;border:1px solid rgba(239,68,68,.15);background:rgba(239,68,68,.02)">
      <div class="card-title"><span class="icon">ğŸš¨</span><span class="txt">ë§¤ì¶œì—ì„œ ë¹ ì ¸ë‚˜ê°€ëŠ” ëˆ</span></div>
      <div class="card-sub">ë§¤ì¶œì´ì•¡ 31,046,433ì›</div>
      <div class="exp-grid" id="expGrid"></div>
      <div class="insight" style="background:var(--yellow-soft);border:1px solid rgba(245,158,11,.2);color:#92610A">
        ğŸ’¡ ë§¤ì¶œ 3,105ë§Œì› â†’ ì‹¤ì…ê¸ˆ <strong style="color:var(--text)">1,855ë§Œì›</strong> â†’ ì”ì•¡ <strong style="color:var(--purple)">831ë§Œì›(28.8%)</strong>
      </div>
    </div>
    <div class="grid-2 anim" style="animation-delay:.1s">
      <div class="card">
        <div class="card-title"><span class="icon">ğŸ©</span><span class="txt">ë¹„ìš© êµ¬ì¡°</span></div>
        <div class="card-sub">ì´ ì§€ì¶œ ëŒ€ë¹„ ë¹„ì¤‘</div>
        <div style="height:220px"><canvas id="expPieChart"></canvas></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="icon">ğŸ“‘</span><span class="txt">íŒê´€ë¹„ ìƒì„¸</span></div>
        <div class="card-sub">í•©ê³„ 1,891,170ì›</div>
        <div id="opexList"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â• ğŸ“± ì±„ë„ ë¶„ì„ â•â•â•â• -->
  <div class="panel" id="panel-channel">
    <div class="grid-2 anim">
      <div class="card">
        <div class="card-title"><span class="icon">ğŸ“±</span><span class="txt">ì±„ë„ë³„ ë§¤ì¶œ</span></div>
        <div class="card-sub">ë§¤ì¶œì´ì•¡ ê¸°ì¤€</div>
        <div style="height:300px"><canvas id="channelChart"></canvas></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="icon">ğŸ’³</span><span class="txt">ì±„ë„ë³„ ìˆ˜ìˆ˜ë£Œìœ¨</span></div>
        <div class="card-sub">ë†’ì„ìˆ˜ë¡ ë¹ ì ¸ë‚˜ê°€ëŠ” ëˆì´ ë§ìŒ</div>
        <div id="feeRateBars"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â• ğŸ“‹ ì†ìµê³„ì‚°ì„œ â•â•â•â• -->
  <div class="panel" id="panel-pnl">
    <div class="pnl-kpi anim" id="pnlKpis"></div>
    <div class="card anim" style="animation-delay:.1s">
      <div class="card-title"><span class="icon">ğŸ“‹</span><span class="txt">ì†ìµê³„ì‚°ì„œ</span></div>
      <div class="card-sub">2026ë…„ 1ì›” Â· ìˆ˜ê¸° ì…ë ¥ <span class="pnl-save-msg" id="pnlSaveMsg">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</span></div>
      <div id="pnlTable"></div>
    </div>
  </div>

  <!-- Footer -->
  <div style="margin-top:28px;padding:14px 0;border-top:1px solid var(--border);display:flex;justify-content:space-between">
    <span style="font-size:10.5px;color:var(--text-muted)">ğŸ“§ ë©”ì¼íŒŒì‹± + ğŸ“· OCR ìë™ì…ë ¥</span>
    <span style="font-size:10.5px;color:var(--text-muted)">ë§¤ì¶œì§€í‚´ì´ v2.0</span>
  </div>
</div>

<script>
/* â•â•â• DATA â•â•â• */
const CAL = {
  1:{total:391800,meat:327600,other:64200,items:["ëª©ì „ì§€ 22.6ë§Œ","ì‚¼ê²¹ 10.2ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì "]},
  2:{total:324800,meat:277500,other:47300,items:["ëª©ì „ì§€ 15.1ë§Œ","ì‚¼ê²¹ 11.9ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ê¸°íƒ€ë§ˆíŠ¸"]},
  3:{total:83300,meat:83300,other:0,items:["ëª©ì „ì§€ 7.6ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì "]},
  4:{total:419220,meat:224400,other:194820,items:["ëª©ì „ì§€ 11.5ë§Œ","ì‚¼ê²¹ 10.9ë§Œ","ê¹€ì¹˜ 7.2ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ë‹¤ë´„í‘¸ë“œ","ì€ì§€ë„¤"]},
  5:{total:289080,meat:176600,other:112480,items:["ëª©ì „ì§€ 11.3ë§Œ","ë‹¬ê±€ 4.2ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ì œì¼ì‹ìì¬"]},
  6:{total:285080,meat:132300,other:152780,items:["ëª©ì „ì§€ 7.5ë§Œ","ì‚¼ê²¹ 5.7ë§Œ","ê¹€ì¹˜ 4.8ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ê°€ì˜¨ìƒì‚¬"]},
  7:{total:668600,meat:123000,other:545600,items:["ìŒ€ 23.7ë§Œ","ìŠ¤íŒ¸ 10.3ë§Œ","ëª©ì „ì§€ 11.5ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ê¸°íƒ€ë§ˆíŠ¸","ì œì¼ì‹ìì¬"]},
  8:{total:146800,meat:127800,other:19000,items:["ëª©ì „ì§€ 7.5ë§Œ","ì‚¼ê²¹ 5.3ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì "]},
  9:{total:382520,meat:209300,other:173220,items:["ëª©ì „ì§€ 15.1ë§Œ","ê³ ì¶§ê°€ë£¨ 7ë§Œ","ê¹€ì¹˜ 4.8ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ë‹¤ë´„í‘¸ë“œ"]},
  10:{total:248600,meat:92000,other:156600,items:["ìˆœë‘ë¶€ 9.5ë§Œ","ì‚¼ê²¹ 5.4ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ì€ì§€ë„¤"]},
  11:{total:484280,meat:303800,other:180480,items:["ëª©ì „ì§€ 18.8ë§Œ","ì‚¼ê²¹ 10.8ë§Œ","ë‹¬ê±€ 4.2ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ì€ì§€ë„¤","ê¸°íƒ€ë§ˆíŠ¸"]},
  12:{total:684260,meat:211500,other:472760,items:["ìŒ€ 23.8ë§Œ","ëª©ì „ì§€ 15ë§Œ","ìŠ¤íŒ¸ 10.3ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ê¸°íƒ€ë§ˆíŠ¸","ì œì¼ì‹ìì¬"]},
  13:{total:273500,meat:144600,other:128900,items:["ëª©ì „ì§€ 7.5ë§Œ","ì‚¼ê²¹ 6.2ë§Œ","ê¹€ì¹˜ 4.8ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ê°€ì˜¨ìƒì‚¬"]},
  14:{total:446030,meat:112900,other:333130,items:["ê³ ì¶§ê°€ë£¨ 7ë§Œ","ëª©ì „ì§€ 11.3ë§Œ","ë‹¤ì‹œë‹¤ 9.1ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ë‹¤ë´„í‘¸ë“œ"]},
  15:{total:323300,meat:219000,other:104300,items:["ëª©ì „ì§€ 11.3ë§Œ","ì‚¼ê²¹ 10.6ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì ","ì€ì§€ë„¤"]},
  16:{total:240500,meat:219500,other:21000,items:["ëª©ì „ì§€ 15ë§Œ","ì‚¼ê²¹ 6.2ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì "]},
  17:{total:271400,meat:266900,other:4500,items:["ëª©ì „ì§€ 15.1ë§Œ","ì‚¼ê²¹ 11.6ë§Œ"],suppliers:["ì¹œì ˆí•œì •ìœ¡ì "]},
};

const ITEMS = {
  "ëª©ì „ì§€":{color:"#EF4444",supplier:"ì¹œì ˆí•œì •ìœ¡ì ",total:2225300,daily:[226100,150800,75900,115300,112500,75000,115400,75200,151300,37700,188100,150100,75400,112900,112700,150300,150600]},
  "ì‚¼ê²¹":{color:"#3B82F6",supplier:"ì¹œì ˆí•œì •ìœ¡ì ",total:1160800,daily:[101500,119300,0,109100,49600,57300,0,52600,58000,54300,108300,53800,61500,0,106300,61700,116300]},
  "ìš°ì‚¼ê²¹":{color:"#F59E0B",supplier:"ì¹œì ˆí•œì •ìœ¡ì ",total:74500,daily:[0,7400,7400,0,14500,0,7600,0,0,0,7400,7600,7700,0,0,7500,0]},
  "ê¹€ì¹˜(ë‹¤ë´„)":{color:"#FF6B35",supplier:"ì‹ë´„-ë‹¤ë´„í‘¸ë“œ",total:313280,daily:[0,0,0,72000,0,48640,0,0,48640,0,0,96000,0,48000,0,0,0]},
  "ê¹€ì¹˜(ê°€ì˜¨)":{color:"#D97706",supplier:"ê°€ì˜¨ìƒì‚¬",total:192000,daily:[0,0,0,0,0,48000,0,0,48000,0,0,0,48000,0,48000,0,0]},
  "ìŒ€":{color:"#78716C",supplier:"ê¸°íƒ€ë§ˆíŠ¸",total:474600,daily:[0,0,0,0,0,0,237300,0,0,0,0,237300,0,0,0,0,0]},
  "ê³ ì¶§ê°€ë£¨":{color:"#EC4899",supplier:"ì‹ë´„-ë‹¤ë´„í‘¸ë“œ",total:139480,daily:[0,0,0,0,0,0,0,0,69740,0,0,0,0,69740,0,0,0]},
  "ìˆœë‘ë¶€":{color:"#10B981",supplier:"ê°€ë½ì‹œì¥-ì€ì§€ë„¤",total:190000,daily:[0,0,0,47500,0,0,0,0,0,95000,0,0,0,47500,0,0,0]},
  "ìŠ¤íŒ¸":{color:"#6366F1",supplier:"ì œì¼ì‹ìì¬ë§ˆíŠ¸",total:205200,daily:[0,0,0,0,0,0,102600,0,0,0,0,102600,0,0,0,0,0]},
  "ë‹¬ê±€":{color:"#F472B6",supplier:"ë³µìˆ˜ê±°ë˜ì²˜",total:241180,daily:[0,42000,0,42000,42180,0,0,0,0,0,42000,31000,0,42000,0,0,0]},
};
const DAYS = ["1/1","1/2","1/3","1/4","1/5","1/6","1/7","1/8","1/9","1/10","1/11","1/12","1/13","1/14","1/15","1/16","1/17"];

const CHANNELS = [
  {name:"ë°°ë¯¼ ì•Œëœ°í•œì§‘",total:14484533,feeRate:26.34,color:"#3B82F6"},
  {name:"ì¿ íŒ¡ì´ì¸  ê¹€ì¹˜ì°œ",total:11269600,feeRate:25.20,color:"#10B981"},
  {name:"ë°°ë¯¼ ê°€ê²Œë°°ë‹¬",total:2718400,feeRate:9.73,color:"#6366F1"},
  {name:"ì¿ íŒ¡ì´ì¸  ë¶ˆë°±",total:1323600,feeRate:21.04,color:"#FF6B35"},
  {name:"ìš”ê¸°ìš”",total:534500,feeRate:4.89,color:"#8B5CF6"},
  {name:"ë§¤ì¥í¬ìŠ¤",total:490500,feeRate:1.10,color:"#F59E0B"},
  {name:"ë°°ë¯¼ í¬ì¥ì£¼ë¬¸",total:125800,feeRate:5.34,color:"#EC4899"},
  {name:"ë•¡ê²¨ìš”",total:99500,feeRate:4.70,color:"#B0BAC9"},
];
const SUPPLIERS = [
  {name:"ì¹œì ˆí•œì •ìœ¡ì ",amount:3460600,color:"#EF4444"},
  {name:"ì‹ë´„-ë‹¤ë´„í‘¸ë“œ",amount:711550,color:"#FF6B35"},
  {name:"ê¸°íƒ€ ë§ˆíŠ¸",amount:525820,color:"#8490A7"},
  {name:"ì œì¼ì‹ìì¬ë§ˆíŠ¸",amount:484240,color:"#3B82F6"},
  {name:"ê°€ë½ì‹œì¥-ì€ì§€ë„¤",amount:433000,color:"#10B981"},
  {name:"ê°€ì˜¨ìƒì‚¬-ê¹€ì¹˜",amount:192000,color:"#F59E0B"},
  {name:"ì½”ì¹´ì½œë¼",amount:112000,color:"#8B5CF6"},
  {name:"ì‹ë´„-ì¥ë³¼ë ˆ",amount:96800,color:"#6366F1"},
];
const TOP_ITEMS = [
  {name:"ëª©ì „ì§€",amount:2225300,from:"ì¹œì ˆí•œì •ìœ¡ì ",c:"#EF4444"},
  {name:"ì‚¼ê²¹",amount:1160800,from:"ì¹œì ˆí•œì •ìœ¡ì ",c:"#EF4444"},
  {name:"ìŒ€",amount:474600,from:"ê¸°íƒ€ ë§ˆíŠ¸",c:"#8490A7"},
  {name:"ê¹€ì¹˜(ë‹¤ë´„)",amount:313280,from:"ì‹ë´„-ë‹¤ë´„í‘¸ë“œ",c:"#FF6B35"},
  {name:"ë‹¬ê±€",amount:241180,from:"ë³µìˆ˜ê±°ë˜ì²˜",c:"#F59E0B"},
  {name:"ìŠ¤íŒ¸",amount:205200,from:"ì œì¼ì‹ìì¬ë§ˆíŠ¸",c:"#3B82F6"},
  {name:"ê¹€ì¹˜(ê°€ì˜¨)",amount:192000,from:"ê°€ì˜¨ìƒì‚¬",c:"#F59E0B"},
  {name:"ìˆœë‘ë¶€",amount:190000,from:"ì€ì§€ë„¤ì‹í’ˆ",c:"#10B981"},
];
const EXP_PIE = [{name:"ë°°ë‹¬ìˆ˜ìˆ˜ë£Œ",value:7306234,color:"#EF4444"},{name:"ì‹ìì¬",value:6171670,color:"#FF6B35"},{name:"íŒê´€ë¹„",value:1891170,color:"#3B82F6"},{name:"ë°°ë‹¬ë¶€ìì¬",value:324930,color:"#F59E0B"},{name:"ì˜ì—…ì™¸ë¹„ìš©",value:300046,color:"#8B5CF6"}];
const OPEX = [{name:"4ëŒ€ë³´í—˜",amount:851850,icon:"ğŸ¥"},{name:"ì„œë¹„ìŠ¤ì´ìš©ë£Œ",amount:421000,icon:"ğŸ“±"},{name:"ì¿ íŒ¡ì´ì¸  ê´‘ê³ ë¹„",amount:228010,icon:"ğŸ“£"},{name:"ìœ ì§€ë³´ìˆ˜ë¹„",amount:184800,icon:"ğŸ”§"},{name:"ì†Œëª¨í’ˆë¹„",amount:69190,icon:"ğŸ§´"},{name:"ì‹ëŒ€",amount:53420,icon:"ğŸš"},{name:"ë³´í—˜ë£Œ",amount:50000,icon:"ğŸ›¡"},{name:"ë Œíƒˆë£Œ(ì½”ì›¨ì´)",amount:32900,icon:"ğŸ’§"}];
const KPI = {grossSales:31046433,discount:2169593,netSales:28876840,deliveryFee:7306234,actualDeposit:18550224,rawMaterial:6496600,grossProfit:15074006,sgna:1891170,operatingProfit:13182836,nonOpex:300046,netIncome:12882790,reserve:1552322,balance:8310086,ingredients:6171670,deliveryAgent:585750};

const fmtW=n=>n.toLocaleString()+"ì›";
const fmtS=n=>Math.round(n/10000)+"ë§Œ";
const pct=(a,b)=>b?((a/b)*100).toFixed(1)+"%":"0%";

/* â•â•â• TAB SWITCHING â•â•â• */
let currentTab = 'material';
let selectedDay = 12;
let selectedItem = 'ëª©ì „ì§€';
let itemChartInstance = null;
const chartInstances = {};

document.getElementById('tabs').addEventListener('click', e => {
  const btn = e.target.closest('.tab');
  if (!btn) return;
  const id = btn.dataset.tab;
  if (id === currentTab) return;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + id).classList.add('active');
  currentTab = id;
  if (id === 'itemPrice' && !chartInstances.item) renderItemPrice();
  if (id === 'supplier' && !chartInstances.supplier) renderSupplier();
  if (id === 'outflow' && !chartInstances.expPie) renderOutflow();
  if (id === 'channel' && !chartInstances.channel) renderChannel();
  if (id === 'pnl') renderPnl();
});

/* â•â•â• CALENDAR â•â•â• */
function heatColor(total) {
  const max = 684260;
  const r = total / max;
  if (r > 0.8) return {bg:"#FEE2E2",border:"#FCA5A5",text:"#EF4444"};
  if (r > 0.5) return {bg:"#FFF3E0",border:"#FFB74D",text:"#FF6B35"};
  if (r > 0.3) return {bg:"#FFFDE7",border:"#FFF176",text:"#D4A017"};
  return {bg:"#E8F5E9",border:"#A5D6A7",text:"#10B981"};
}

function renderCalendar() {
  const grid = document.getElementById('calGrid');
  const avg = Math.round(KPI.ingredients / 17);
  let html = '';
  // 3 empty cells (Jan 1 = Thu = index 3)
  for (let i = 0; i < 3; i++) html += '<div class="cal-empty"></div>';
  for (let day = 1; day <= 31; day++) {
    const data = CAL[day];
    if (!data) {
      html += `<div class="cal-empty"><div class="day-num">${day}</div>${day>17?'<div style="font-size:9px;color:var(--text-muted);margin-top:4px">ì§‘ê³„ ì „</div>':''}</div>`;
      continue;
    }
    const h = heatColor(data.total);
    const prev = CAL[day-1];
    const change = prev ? data.total - prev.total : 0;
    const changePct = prev ? Math.round((change/prev.total)*100) : 0;
    const sel = day === selectedDay ? ' selected' : '';
    html += `<div class="cal-cell${sel}" data-day="${day}" style="background:${h.bg};border-color:${h.border}">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px">
        <span class="day-num">${day}</span>
        ${prev ? `<span class="change-badge" style="background:${change>0?'var(--red-soft)':'var(--green-soft)'};color:${change>0?'var(--red)':'var(--green)'}">${change>0?'â–²':'â–¼'}${Math.abs(changePct)}%</span>` : ''}
      </div>
      <div class="total" style="color:${h.text}">${fmtS(data.total)}ì›</div>
      <div class="hbar"><div class="hbar-fill" style="width:${(data.total/684260)*100}%;background:${h.text}"></div></div>
      ${data.items.slice(0,2).map(it=>`<div class="item-tag">${it}</div>`).join('')}
      ${data.total > avg*1.5 ? '<div class="alert-dot"></div>' : ''}
    </div>`;
  }
  grid.innerHTML = html;
  grid.querySelectorAll('.cal-cell').forEach(cell => {
    cell.addEventListener('click', () => {
      selectedDay = parseInt(cell.dataset.day);
      grid.querySelectorAll('.cal-cell').forEach(c => c.classList.remove('selected'));
      cell.classList.add('selected');
      renderDayDetail();
    });
  });
  renderDayDetail();
}

function renderDayDetail() {
  const d = CAL[selectedDay];
  if (!d) return;
  const prev = CAL[selectedDay-1];
  const change = prev ? d.total - prev.total : 0;
  const changePct = prev ? Math.round((change/prev.total)*100) : 0;
  const dayNames = ["ëª©","ê¸ˆ","í† ","ì¼","ì›”","í™”","ìˆ˜"];
  const dayName = dayNames[(selectedDay-1+3)%7];

  let html = `<div class="day-detail">
    <div class="top"><div><span style="font-size:16px;font-weight:800">1/${selectedDay}</span><span style="font-size:11px;color:var(--text-dim);margin-left:6px">${dayName}</span></div>
    <div class="amount">${fmtW(d.total)}</div></div>`;
  if (prev) {
    html += `<div style="display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:7px;margin-bottom:10px;background:${change>0?'var(--red-soft)':'var(--green-soft)'}">
      <span style="font-size:11px;color:${change>0?'var(--red)':'var(--green)'};font-weight:600">ì „ì¼ëŒ€ë¹„ ${change>0?'+':''}${fmtW(change)} (${change>0?'+':''}${changePct}%)</span></div>`;
  }
  html += `<div style="margin-bottom:10px"><div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text-dim);margin-bottom:3px"><span>ì •ìœ¡ ${pct(d.meat,d.total)}</span><span>ê¸°íƒ€ ${pct(d.other,d.total)}</span></div>
    <div class="ratio-bar"><div style="width:${(d.meat/d.total)*100}%;background:var(--red);border-radius:4px 0 0 4px"></div><div style="width:${(d.other/d.total)*100}%;background:var(--blue)"></div></div></div>`;
  html += `<div style="margin-bottom:8px"><div style="font-size:10px;font-weight:600;color:var(--text-dim);margin-bottom:4px">ë°œì£¼ í’ˆëª©</div><div class="pill-tags">`;
  const colors = ['var(--red-soft)|var(--red)','var(--blue-soft)|var(--blue)','var(--yellow-soft)|var(--yellow)'];
  d.items.forEach((it,i) => { const [bg,fg] = (colors[i]||colors[2]).split('|'); html += `<span class="pill" style="background:${bg};color:${fg}">${it}</span>`; });
  html += `</div></div><div><div style="font-size:10px;font-weight:600;color:var(--text-dim);margin-bottom:4px">ê±°ë˜ì²˜</div><div class="pill-tags">`;
  d.suppliers.forEach(s => { html += `<span style="font-size:9.5px;padding:2px 6px;border-radius:4px;background:#F0F2F5;color:var(--text-sec)">${s}</span>`; });
  html += '</div></div></div>';
  document.getElementById('dayDetail').innerHTML = html;
}

// KPIs
document.getElementById('material-kpis').innerHTML = [
  {l:"ì‹ìì¬ í•©ê³„",v:KPI.ingredients,icon:"ğŸ¥©",c:"var(--accent)"},
  {l:"ì¼ í‰ê· ",v:Math.round(KPI.ingredients/17),icon:"ğŸ“Š",c:"var(--blue)"},
  {l:"ìµœëŒ€ì¼ (1/12)",v:684260,icon:"ğŸ”º",c:"var(--red)"},
  {l:"ìµœì†Œì¼ (1/3)",v:83300,icon:"ğŸ”»",c:"var(--green)"},
].map(k=>`<div class="card kpi"><div class="bar" style="background:${k.c}"></div><div class="label"><span>${k.icon}</span>${k.l}</div><div class="value" style="color:${k.c}">${fmtW(k.v)}</div></div>`).join('');

renderCalendar();

/* â•â•â• ITEM PRICE â•â•â• */
function renderItemPrice() {
  // Tabs
  const tabsHtml = Object.keys(ITEMS).map(name => {
    const it = ITEMS[name];
    const active = name === selectedItem;
    return `<button class="item-tab${active?' active':''}" data-item="${name}" style="${active?'background:'+it.color+';box-shadow:0 2px 8px '+it.color+'40':''}">${name}</button>`;
  }).join('');
  document.getElementById('itemTabs').innerHTML = tabsHtml;
  document.getElementById('itemTabs').addEventListener('click', e => {
    const btn = e.target.closest('.item-tab');
    if (!btn) return;
    selectedItem = btn.dataset.item;
    renderItemPrice();
  });
  renderItemKpis();
  renderItemChart();
  renderItemTable();
}

function renderItemKpis() {
  const it = ITEMS[selectedItem];
  const active = it.daily.filter(p => p > 0);
  const avg = active.length ? Math.round(active.reduce((a,b)=>a+b,0)/active.length) : 0;
  const max = Math.max(...active, 0);
  const min = Math.min(...active.filter(p=>p>0));
  const fluct = min ? Math.round((max-min)/min*100) : 0;
  document.getElementById('itemKpis').innerHTML = [
    {l:"ì´ ì§€ì¶œ",v:fmtW(it.total),c:it.color},
    {l:"ë°œì£¼ íšŸìˆ˜",v:active.length+"íšŒ",c:"#3B82F6"},
    {l:"í‰ê·  ë°œì£¼ê¸ˆì•¡",v:fmtW(avg),c:"var(--text-sec)"},
    {l:"ìµœëŒ€ ë°œì£¼ê¸ˆì•¡",v:fmtW(max),c:"#EF4444"},
    {l:"ë“±ë½í­",v:fluct+"%",c:fluct>100?"#EF4444":"#F59E0B"},
  ].map(k=>`<div class="box"><div class="lbl">${k.l}</div><div class="val" style="color:${k.c}">${k.v}</div></div>`).join('');
}

function renderItemChart() {
  const it = ITEMS[selectedItem];
  const active = it.daily.filter(p=>p>0);
  const avg = active.length ? Math.round(active.reduce((a,b)=>a+b,0)/active.length) : 0;
  if (itemChartInstance) itemChartInstance.destroy();
  const ctx = document.getElementById('itemChart').getContext('2d');
  itemChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: DAYS,
      datasets: [{
        label: selectedItem + ' ë°œì£¼ê¸ˆì•¡',
        data: it.daily.map(v => v || null),
        borderColor: it.color,
        backgroundColor: it.color + '15',
        fill: true,
        tension: 0.3,
        pointRadius: it.daily.map(v => v > 0 ? 5 : 0),
        pointBackgroundColor: it.color,
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        spanGaps: false,
        borderWidth: 2.5,
      }, {
        label: 'í‰ê· ',
        data: DAYS.map(() => avg),
        borderColor: '#FF6B35',
        borderDash: [6, 4],
        borderWidth: 1.5,
        pointRadius: 0,
        fill: false,
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { labels: { font: { size: 11, family: 'Pretendard' }, usePointStyle: true, pointStyle: 'circle' } },
        tooltip: {
          callbacks: { label: ctx => ctx.parsed.y ? ctx.dataset.label + ': ' + fmtW(ctx.parsed.y) : '' },
          titleFont: { family: 'Pretendard' }, bodyFont: { family: 'Pretendard' }
        }
      },
      scales: {
        x: { grid: { display: false }, ticks: { font: { size: 10, family: 'Pretendard' } } },
        y: { grid: { color: '#E4E7EE' }, ticks: { font: { size: 10, family: 'Pretendard' }, callback: v => fmtS(v) } }
      }
    }
  });
  chartInstances.item = true;
}

function renderItemTable() {
  const it = ITEMS[selectedItem];
  const active = it.daily.map((p,i) => ({d:DAYS[i],price:p})).filter(d=>d.price>0);
  const avg = active.length ? Math.round(active.reduce((a,b)=>a+b.price,0)/active.length) : 0;
  let html = '<table class="tbl"><thead><tr><th style="text-align:left">ë‚ ì§œ</th><th>ë°œì£¼ê¸ˆì•¡</th><th>ì „íšŒëŒ€ë¹„</th><th>í‰ê· ëŒ€ë¹„</th><th style="text-align:left">ê±°ë˜ì²˜</th></tr></thead><tbody>';
  active.forEach((d,i) => {
    const prev = i > 0 ? active[i-1] : null;
    const diff = prev ? d.price - prev.price : 0;
    const diffPct = prev ? Math.round((diff/prev.price)*100) : 0;
    const avgDiff = Math.round((d.price-avg)/avg*100);
    html += `<tr>
      <td>${d.d}</td>
      <td style="color:${it.color};font-weight:700">${fmtW(d.price)}</td>
      <td>${prev ? `<span style="color:${diff>0?'var(--red)':diff<0?'var(--green)':'var(--text-dim)'};font-weight:600">${diff>0?'â–²':diff<0?'â–¼':'âˆ’'}${diff?fmtW(Math.abs(diff)):''} <span style="font-size:9px">${diffPct?'('+(diff>0?'+':'')+diffPct+'%)':''}</span></span>` : '<span style="color:var(--text-muted);font-size:10px">â€”</span>'}</td>
      <td><span style="font-size:10px;padding:2px 5px;border-radius:4px;background:${avgDiff>0?'var(--red-soft)':'var(--green-soft)'};color:${avgDiff>0?'var(--red)':'var(--green)'};font-weight:600">${avgDiff>0?'+':''}${avgDiff}%</span></td>
      <td style="font-size:10.5px;color:var(--text-dim)">${it.supplier}</td>
    </tr>`;
  });
  html += '</tbody></table>';
  document.getElementById('itemTable').innerHTML = html;
}

/* â•â•â• SUPPLIER â•â•â• */
function renderSupplier() {
  const ctx = document.getElementById('supplierChart').getContext('2d');
  chartInstances.supplier = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: SUPPLIERS.map(s=>s.name),
      datasets: [{data:SUPPLIERS.map(s=>s.amount),backgroundColor:SUPPLIERS.map(s=>s.color),borderRadius:6,barPercentage:.6}]
    },
    options: {
      indexAxis: 'y', responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => fmtW(ctx.parsed.x) }, bodyFont:{family:'Pretendard'} } },
      scales: { x:{grid:{color:'#E4E7EE'},ticks:{font:{size:10,family:'Pretendard'},callback:v=>fmtS(v)}}, y:{grid:{display:false},ticks:{font:{size:11,family:'Pretendard'}}} }
    }
  });
  // Top items
  document.getElementById('topItemBars').innerHTML = TOP_ITEMS.map((x,i) => `<div class="sup-bar">
    <div class="top"><span class="nm">${i+1}. ${x.name}</span><div style="display:flex;gap:8px;font-size:11px"><span style="color:var(--text-dim)">${x.from}</span><span class="amt">${fmtW(x.amount)}</span></div></div>
    <div class="track"><div class="fill" style="width:${(x.amount/2225300)*100}%;background:${x.c}"></div></div></div>`).join('');
}

/* â•â•â• OUTFLOW â•â•â• */
function renderOutflow() {
  document.getElementById('expGrid').innerHTML = [
    {l:"ë°°ë‹¬ìˆ˜ìˆ˜ë£Œ",v:7306234,r:"25.3%",c:"var(--red)"},
    {l:"í• ì¸/ì¿ í°",v:2169593,r:"7.0%",c:"var(--yellow)"},
    {l:"ì›ì¬ë£Œ",v:6496600,r:"22.5%",c:"var(--accent)"},
    {l:"íŒê´€ë¹„+ì˜ì—…ì™¸",v:2191216,r:"7.1%",c:"var(--blue)"},
  ].map(x=>`<div class="exp-card"><div class="lbl">${x.l}</div><div class="val" style="color:${x.c}">${fmtW(x.v)}</div><div class="sub" style="color:${x.c}">ë§¤ì¶œì˜ ${x.r}</div></div>`).join('');

  const ctx = document.getElementById('expPieChart').getContext('2d');
  chartInstances.expPie = new Chart(ctx, {
    type: 'doughnut',
    data: { labels:EXP_PIE.map(e=>e.name), datasets:[{data:EXP_PIE.map(e=>e.value),backgroundColor:EXP_PIE.map(e=>e.color),borderWidth:0,spacing:3}] },
    options: { responsive:true, maintainAspectRatio:false, cutout:'60%',
      plugins:{ legend:{position:'bottom',labels:{font:{size:10.5,family:'Pretendard'},usePointStyle:true,pointStyle:'rectRounded',padding:12}},
        tooltip:{callbacks:{label:ctx=>ctx.label+': '+fmtW(ctx.parsed)},bodyFont:{family:'Pretendard'}} } }
  });

  document.getElementById('opexList').innerHTML = OPEX.map(x=>`<div class="opex-item"><div class="left"><span class="icon">${x.icon}</span><span class="nm">${x.name}</span></div><span class="amt">${fmtW(x.amount)}</span></div>`).join('');
}

/* â•â•â• CHANNEL â•â•â• */
function renderChannel() {
  const ctx = document.getElementById('channelChart').getContext('2d');
  chartInstances.channel = new Chart(ctx, {
    type: 'bar',
    data: { labels:CHANNELS.slice(0,6).map(c=>c.name), datasets:[{data:CHANNELS.slice(0,6).map(c=>c.total),backgroundColor:CHANNELS.slice(0,6).map(c=>c.color),borderRadius:6,barPercentage:.6}] },
    options: { indexAxis:'y', responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{display:false}, tooltip:{callbacks:{label:ctx=>fmtW(ctx.parsed.x)},bodyFont:{family:'Pretendard'}} },
      scales:{ x:{grid:{color:'#E4E7EE'},ticks:{font:{size:10,family:'Pretendard'},callback:v=>fmtS(v)}}, y:{grid:{display:false},ticks:{font:{size:11,family:'Pretendard'}}} } }
  });
  document.getElementById('feeRateBars').innerHTML = CHANNELS.map(ch=>{
    const c = ch.feeRate>20?'var(--red)':ch.feeRate>10?'var(--yellow)':'var(--green)';
    return `<div class="fee-row"><div class="top"><span class="nm">${ch.name}</span><span class="rate" style="color:${c}">${ch.feeRate}%</span></div>
    <div class="track"><div class="fill" style="width:${(ch.feeRate/30)*100}%;background:${c}"></div></div></div>`;
  }).join('');
}

/* â•â•â• PNL â•â•â• */
let pnlRendered = false;

function pnlRecalc() {
  const g = k => parseInt(document.getElementById('pnl-'+k).value.replace(/,/g,''))||0;
  const grossSales = g('grossSales');
  const discount = g('discount');
  const deliveryFee = g('deliveryFee');
  const deliveryAgent = g('deliveryAgent');
  const rawMaterial = g('rawMaterial');
  const sgna = g('sgna');
  const nonOpex = g('nonOpex');
  const reserve = g('reserve');

  const netSales = grossSales - discount;
  const grossProfit = netSales - deliveryFee - deliveryAgent - rawMaterial;
  const operatingProfit = grossProfit - sgna;
  const netIncome = operatingProfit - nonOpex;
  const balance = netIncome - reserve;

  KPI.grossSales=grossSales; KPI.discount=discount; KPI.netSales=netSales;
  KPI.deliveryFee=deliveryFee; KPI.deliveryAgent=deliveryAgent; KPI.rawMaterial=rawMaterial;
  KPI.grossProfit=grossProfit; KPI.sgna=sgna; KPI.operatingProfit=operatingProfit;
  KPI.nonOpex=nonOpex; KPI.netIncome=netIncome; KPI.reserve=reserve; KPI.balance=balance;

  document.getElementById('pnl-netSales').textContent = fmtW(netSales);
  document.getElementById('pnl-grossProfit').textContent = fmtW(grossProfit);
  document.getElementById('pnl-operatingProfit').textContent = fmtW(operatingProfit);
  document.getElementById('pnl-netIncome').textContent = fmtW(netIncome);
  document.getElementById('pnl-balance').textContent = fmtW(balance);

  document.getElementById('pnl-netSales-pct').textContent = pct(netSales,grossSales);
  document.getElementById('pnl-grossProfit-pct').textContent = pct(grossProfit,grossSales);
  document.getElementById('pnl-operatingProfit-pct').textContent = pct(operatingProfit,grossSales);
  document.getElementById('pnl-netIncome-pct').textContent = pct(netIncome,grossSales);
  document.getElementById('pnl-balance-pct').textContent = pct(balance,grossSales);
  document.getElementById('pnl-discount-pct').textContent = pct(discount,grossSales);
  document.getElementById('pnl-deliveryFee-pct').textContent = pct(deliveryFee,grossSales);
  document.getElementById('pnl-deliveryAgent-pct').textContent = pct(deliveryAgent,grossSales);
  document.getElementById('pnl-rawMaterial-pct').textContent = pct(rawMaterial,grossSales);
  document.getElementById('pnl-sgna-pct').textContent = pct(sgna,grossSales);
  document.getElementById('pnl-nonOpex-pct').textContent = pct(nonOpex,grossSales);
  document.getElementById('pnl-reserve-pct').textContent = pct(reserve,grossSales);
  document.getElementById('pnl-grossSales-pct').textContent = '100%';

  updatePnlKpis();

  try{localStorage.setItem('pnlData',JSON.stringify({grossSales,discount,deliveryFee,deliveryAgent,rawMaterial,sgna,nonOpex,reserve}));}catch(e){}
  const msg=document.getElementById('pnlSaveMsg');
  msg.classList.add('show');
  setTimeout(()=>msg.classList.remove('show'),1500);
}

function updatePnlKpis() {
  const items = [
    {l:"ë§¤ì¶œì´ì•¡",v:KPI.grossSales,icon:"ğŸ’°",c:"var(--text)"},
    {l:"ìˆœë§¤ì¶œ",v:KPI.netSales,icon:"ğŸ“Š",c:"var(--blue)",sub:true},
    {l:"ë§¤ì¶œì´ì´ìµ",v:KPI.grossProfit,icon:"ğŸ¦",c:"var(--green)",sub:true},
    {l:"ë‹¹ê¸°ìˆœì´ìµ",v:KPI.netIncome,icon:"ğŸ“ˆ",c:"var(--accent)",sub:true},
    {l:"ì ë¦½ í›„ ì”ì•¡",v:KPI.balance,icon:"ğŸ’µ",c:"var(--purple)",sub:true},
  ];
  document.getElementById('pnlKpis').innerHTML = items.map(k=>`<div class="card kpi"><div class="bar" style="background:${k.c}"></div><div class="label"><span>${k.icon}</span>${k.l}</div><div class="value" style="font-size:18px;color:${k.c}">${fmtW(k.v)}</div>${k.sub?'<span style="font-size:11px;color:var(--text-dim)">ë§¤ì¶œ ëŒ€ë¹„ '+pct(k.v,KPI.grossSales)+'</span>':''}</div>`).join('');
}

function fmtInput(v){return v.toLocaleString();}
function onPnlInput(e){
  const raw=e.target.value.replace(/[^0-9]/g,'');
  const num=parseInt(raw)||0;
  const pos=e.target.selectionStart;
  const oldLen=e.target.value.length;
  e.target.value=num.toLocaleString();
  const newLen=e.target.value.length;
  e.target.setSelectionRange(pos+newLen-oldLen,pos+newLen-oldLen);
  pnlRecalc();
}

function renderPnl() {
  let saved=null;
  try{saved=JSON.parse(localStorage.getItem('pnlData'));}catch(e){}
  if(saved){
    KPI.grossSales=saved.grossSales; KPI.discount=saved.discount;
    KPI.deliveryFee=saved.deliveryFee; KPI.deliveryAgent=saved.deliveryAgent;
    KPI.rawMaterial=saved.rawMaterial; KPI.sgna=saved.sgna;
    KPI.nonOpex=saved.nonOpex; KPI.reserve=saved.reserve;
    KPI.netSales=KPI.grossSales-KPI.discount;
    KPI.grossProfit=KPI.netSales-KPI.deliveryFee-KPI.deliveryAgent-KPI.rawMaterial;
    KPI.operatingProfit=KPI.grossProfit-KPI.sgna;
    KPI.netIncome=KPI.operatingProfit-KPI.nonOpex;
    KPI.balance=KPI.netIncome-KPI.reserve;
  }

  updatePnlKpis();

  const inputRow = (label, key, neg) => `<div class="pnl-row">
    <span>${neg?'<span style="color:var(--red);font-size:10px">âˆ’</span> ':''}${label} <span style="font-size:8.5px;background:var(--blue-soft);color:var(--blue);padding:1px 5px;border-radius:3px;font-weight:700">ì…ë ¥</span></span>
    <span style="display:flex;align-items:center;gap:12px"><input type="text" id="pnl-${key}" class="pnl-input" value="${fmtInput(KPI[key])}" oninput="onPnlInput(event)"><span id="pnl-${key}-pct" style="color:var(--text-dim);font-size:11.5px;min-width:50px;text-align:right">${pct(KPI[key],KPI.grossSales)}</span></span>
  </div>`;

  const calcRow = (label, key, hl, bold, big) => `<div class="pnl-row ${bold?'bold ':''} ${big?'highlight':''}">
    <span>${label} <span style="font-size:8.5px;background:var(--green-soft);color:var(--green);padding:1px 5px;border-radius:3px;font-weight:700">ìë™</span></span>
    <span style="display:flex;gap:30px"><span id="pnl-${key}" style="color:${hl||'var(--text)'};font-variant-numeric:tabular-nums;${big?'font-size:14px':''}">${fmtW(KPI[key])}</span><span id="pnl-${key}-pct" style="color:var(--text-dim);font-size:11.5px;min-width:50px;text-align:right">${pct(KPI[key],KPI.grossSales)}</span></span>
  </div>`;

  document.getElementById('pnlTable').innerHTML =
    inputRow("ë§¤ì¶œì´ì•¡","grossSales",false)+
    inputRow("í• ì¸/ì¿ í°","discount",true)+
    calcRow("ìˆœë§¤ì¶œ","netSales","var(--blue)",true,false)+
    inputRow("ë°°ë‹¬ìˆ˜ìˆ˜ë£Œ","deliveryFee",true)+
    inputRow("ë°°ë‹¬ëŒ€í–‰ë¹„","deliveryAgent",true)+
    inputRow("ì›ì¬ë£Œ(ì‹ìì¬+ë¶€ìì¬)","rawMaterial",true)+
    calcRow("ë§¤ì¶œì´ì´ìµ","grossProfit","var(--green)",true,false)+
    inputRow("íŒë§¤ê´€ë¦¬ë¹„","sgna",true)+
    calcRow("ì˜ì—…ì´ìµ","operatingProfit","var(--accent)",true,false)+
    inputRow("ì˜ì—…ì™¸ë¹„ìš©","nonOpex",true)+
    calcRow("ë‹¹ê¸°ìˆœì´ìµ","netIncome","var(--green)",true,true)+
    inputRow("ì ë¦½(ì„¸ê¸ˆ+í‡´ì§ê¸ˆ)","reserve",true)+
    calcRow("ì ë¦½ í›„ ì”ì•¡","balance","var(--purple)",true,false);

  pnlRendered = true;
}
</script>
</body>
</html>
